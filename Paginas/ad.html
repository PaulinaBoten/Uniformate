<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Panel de Administración</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #d3eeaf;
    padding: 20px;
  }
  h2 {
    text-align: center;
    margin-bottom: 1rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
    background: white;
    border-radius: 8px;
    overflow: hidden;
  }
  th, td {
    padding: 0.8rem;
    border: 1px solid #ddd;
    text-align: center;
  }
  th {
    background: #279419;
    color: white;
  }
  td[contenteditable="true"] {
    background-color: #f9fff0;
  }
  button {
    padding: 0.6rem 1rem;
    background: #12490a;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
  }
  button:hover {
    background: #1d6b13;
  }
</style>
</head>
<body>

<h2 id="bienvenida">Panel de Administración</h2>
<a href="./prin.html">
<button onclick="cerrarSesion()">Cerrar Sesión</button>
</a>

<h3>Inventario</h3>
<table id="tablaInventario">
  <tr>
    <th>ID</th>
    <th>Producto</th>
    <th>Cantidad</th>
    <th>Tallaje</th>
  </tr>
  <tr>
    <td contenteditable="true">1</td>
    <td contenteditable="true">jumper</td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
  </tr>
  <tr>
    <td contenteditable="true">2</td>
    <td contenteditable="true">camisa gala</td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
  </tr>
  <tr>
    <td contenteditable="true">3</td>
    <td contenteditable="true">medias gala</td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
  </tr><tr>
    <td contenteditable="true">4</td>
    <td contenteditable="true">zapatos negros colegiala</td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
  </tr><tr>
    <td contenteditable="true">5</td>
    <td contenteditable="true">buso tejido</td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
  </tr><tr>
    <td contenteditable="true">6</td>
    <td contenteditable="true">chaqueta impermiable</td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
  </tr><tr>
    <td contenteditable="true">7</td>
    <td contenteditable="true">sudadera deportiva</td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
  </tr><tr>
    <td contenteditable="true">8</td>
    <td contenteditable="true">camisa polo</td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
  </tr><tr>
    <td contenteditable="true">9</td>
    <td contenteditable="true">medias sudadera</td>
    <td contenteditable="true"></td>
    <td contenteditable="true"></td>
  </tr>
  <!-- Puedes seguir el mismo patrón para el resto -->
</table>
<button onclick="guardarTabla('tablaInventario')">Guardar Cambios Inventario</button>
<h3>Pedidos Recientes</h3>
<table id="tablaPedidos">
  <thead>
    <tr>
      <th>ID Pedido</th>
      <th>Cliente</th>
      <th>Producto</th>
      <th>Estado</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
      <td contenteditable="true"></td>
    </tr>
  </tbody>
</table>
<button onclick="guardarTabla('tablaPedidos')">Guardar Cambios Pedidos</button>

<script>
  function cerrarSesion() {
    sessionStorage.removeItem("usuario");
    window.location.href = "Admin.html";
  }

  // Verificación de sesión
  const usuario = sessionStorage.getItem("usuario");
  if (!usuario) {
    alert("Acceso denegado. Inicie sesión primero.");
    window.location.href = "Admin.html";
  } else {
    document.getElementById("bienvenida").textContent = 'Bienvenida, administradora';
  }

  function guardarTabla(idTabla) {
    const tabla = document.getElementById(idTabla);
    const filas = tabla.querySelectorAll("tbody tr");
    const datos = [];

    for (let i = 0; i < filas.length; i++) {
      const celdas = filas[i].querySelectorAll("td");
      const fila = [];
      celdas.forEach(td => fila.push(td.textContent.trim()));
      // Solo guarda filas que tengan algún dato
      if (fila.some(val => val !== "")) {
        datos.push(fila);
      }
    }

    localStorage.setItem(idTabla, JSON.stringify(datos));
    alert("Cambios guardados localmente.");
  }

  // Autoagrega fila nueva en tablaPedidos cuando se empieza a escribir en la última
  const tablaPedidos = document.getElementById("tablaPedidos").getElementsByTagName("tbody")[0];

  tablaPedidos.addEventListener("input", function (e) {
    const filas = tablaPedidos.querySelectorAll("tr");
    const ultimaFila = filas[filas.length - 1];

    // Verificar si se está escribiendo en la última fila
    if (ultimaFila.contains(e.target)) {
      // Si la última fila ya tiene algún contenido, agregamos una nueva fila
      const celdas = ultimaFila.querySelectorAll("td");
      const tieneContenido = Array.from(celdas).some(td => td.textContent.trim() !== "");

      if (tieneContenido) {
        const nuevaFila = document.createElement("tr");
        for (let i = 0; i < 4; i++) {
          const td = document.createElement("td");
          td.setAttribute("contenteditable", "true");
          nuevaFila.appendChild(td);
        }
        tablaPedidos.appendChild(nuevaFila);
      }
    }
  });
</script>